/**
  ******************************************************************************
  * @file    Templates/Inc/main.h 
  * @author  MCD Application Team
  * @version V1.0.0
  * @date    22-April-2016
  * @brief   Header for main.c module
  ******************************************************************************
  * @attention
  *
  * <h2><center>&copy; COPYRIGHT(c) 2016 STMicroelectronics</center></h2>
  *
  * Redistribution and use in source and binary forms, with or without modification,
  * are permitted provided that the following conditions are met:
  *   1. Redistributions of source code must retain the above copyright notice,
  *      this list of conditions and the following disclaimer.
  *   2. Redistributions in binary form must reproduce the above copyright notice,
  *      this list of conditions and the following disclaimer in the documentation
  *      and/or other materials provided with the distribution.
  *   3. Neither the name of STMicroelectronics nor the names of its contributors
  *      may be used to endorse or promote products derived from this software
  *      without specific prior written permission.
  *
  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
  * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
  * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
  * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  *
  ******************************************************************************
  */
  
/* Define to prevent recursive inclusion -------------------------------------*/
#ifndef __MAIN_H
#define __MAIN_H

/* Includes ------------------------------------------------------------------*/
#include "delay.h"
#include "usart.h"
#include "wm8978.h"	 
#include "recorder.h"
#include "led.h"
#include "nfc.h"
#include "button.h"
#include "arm_math.h"
#include "fir2.h"
#include "audioDataTransProcess.h"
#include "env.h"


/* Exported types ------------------------------------------------------------*/
#define WHITE_NOISE_LENGTH 1024
#define SampleRate 44100

typedef enum
{
	DEVICE_WORK_NOFLITER = 0,
	DEVICE_WORK_CONFIGURATION,
	DEVICE_WORK_WITH_FLITER,
	DEVICE_WORK_WITH_DEFAULT_FILTER,
	DEVICE_WORK_ERROR
}DEVICE_WORK_MODE;

typedef enum
{
	BUTTON_STATUS_DEFAULT = 0,
	BUTTON_STATUS_RISING,
	BUTTON_STATUS_FALLING
}BUTTON_STATUS;

/* Exported constants --------------------------------------------------------*/
#define BLOCK_SIZE SAI_RX_DMA_BUF_SIZE / 4
#define NUM_TAPS 256
#define STD_LESS_DB 10

static int16_t *MUSIC = NULL;
static int16_t *VOCAL = NULL;

const static int16_t WHITE[WHITE_NOISE_LENGTH] = {14591, 11837, 15967, 6740, 3966, 10162, 10030, 18443, 8911, 7830, 12627, 13550, 12021, 2867, 18673, 12184, 19512, 16517, 18008, 20298, 16850, 20857, 17936, 2271, 7589, 9830, -1817, 2776, 9820, 14379, 6715, 14697, 9853, 9846, 4992, 11049, 17478, 20900, 22588, 17698, 14069, 9102, 11393, 34, 3358, -4505, -1638, 258, 4171, 2220, -4669, -10713, -2386, -5829, -9415, -13813, -6081, -11487, -16352, -10047, -4480, -11346, -7059, -6177, -9988, -117, 3019, -5524, -11113, -9493, 6545, 10142, 3526, -1932, 9787, 11160, -4759, -5620, 4619, 7322, 1563, -5675, -126, 1285, -7300, -10768, -11338, -10080, -7783, 277, 1585, -4583, 5568, -4130, 9405, 9176, 3590, -6339, -5233, -16121, -17363, -16929, -8805, -7241, -7216, 8179, 8107, -3167, 1051, -10186, 1938, -2516, 4076, -1639, -7793, -8904, -724, -2111, -11069, 2398, 7168, -1946, 10366, 2475, 4961, 6702, 973, -4564, -6268, -13198, -8175, -7311, -2671, -12783, 1251, 4391, -9899, -9773, -2168, -3517, -18491, -19527, -19341, -12352, -13716, -8214, -10302, -11234, -20861, -20671, -16171, -18982, -6909, -17623, 863, -12584, -6540, -11382, -16217, 1199, -8351, -13060, 555, -14032, -11363, -12752, 4974, 6868, 6064, 3320, -3078, 95, -10040, -6607, -8968, -11096, -14325, -10790, -2634, 8712, 8043, 1870, 5791, 2121, 3117, 4740, 9930, 9642, 8420, 13413, 10932, 1919, 76, -2602, -9248, -4305, 1867, -4850, 9030, 13442, 14422, 8014, 17351, 10570, 2888, 8393, 4732, 14754, 20376, 19753, 19466, 3066, 13061, 567, 1160, 9914, 11250, 10199, 1092, 7993, 703, 7129, -2329, -2308, -11189, -9537, -4841, 1092, 6944, 3732, 15459, 7467, 17291, 8284, 11708, 13388, 5607, 9104, 18406, 14561, 8179, 12417, 12103, 10137, 5953, -4577, 2169, 2785, 3296, -4624, -10390, 3712, -9279, -6787, -13258, -11502, -19066, -17566, -12555, -6405, 1507, -9074, -4058, 4157, -6876, -10411, 148, 745, 13712, 9739, 15444, 9490, 8094, 1793, 4528, -7961, -3112, 5313, 2178, 4028, -7533, -6906, -12492, -1200, -10416, -10582, -3466, -2327, -6595, -1889, -11375, -14111, -14935, -3658, 186, -1282, 5127, -8710, -4830, 6968, 129, -3991, -4135, 8639, -1120, 8943, -1795, -2044, 7935, 9954, 1974, -3943, 3471, 4721, 11583, 6728, 13745, 823, 5708, 11227, 4339, 17747, 15882, 16890, 17170, 14311, 2374, -4757, -6918, 8660, 8602, -966, -11005, 1608, -14425, -11180, -20938, -22162, -21659, -19528, -11407, -13580, -14220, -14527, 4410, 7486, 11128, 17367, 9835, 16811, 1547, 13331, 14680, 1485, 15244, 19443, 18092, 8992, 15996, 7626, 3260, 10717, 2469, 19893, 24214, 22391, 20135, 15572, 17754, 15069, 8191, 9211, 10782, 9795, 3405, -11184, 861, -16732, -13905, -17597, -17687, -3442, -9096, -15512, -5399, -14823, -4525, -5430, -134, -7490, -3947, 3006, -10766, -1641, -3465, 5855, 6419, 3936, 10164, 3146, 3680, -2396, 10544, 9965, -4836, -7044, -968, -13212, -10214, -7634, -1285, -11265, -15570, -13062, -12393, -19291, -19421, -14011, -18833, -11822, -12389, 1186, -7962, -3994, -15282, -8841, -17777, -8359, -15379, -8551, -8456, 918, -8600, -12628, -2766, -231, -1270, -1184, 10915, -327, 11491, 11862, 7138, 1075, 19793, 20519, 19186, 16842, 4768, 3975, 8170, 6073, 14963, 17400, 20395, 17344, 8155, 2796, -6063, 2364, 5957, -6679, -5596, 8109, 4852, 7080, 7501, 5090, 5601, 16401, 16415, 14451, 6228, 686, 479, -5627, -3800, -11031, -6839, -11014, -2636, -15583, -10171, -5882, -17850, -17400, -19456, -14136, -17378, -20209, -14870, -3897, -15448, 3093, -1279, -2431, 2060, 1872, -13455, -8461, -14297, -10086, -3027, 7846, 4431, 12967, 9882, -2189, 3094, 8904, 15154, 17607, 18136, 21456, 20021, 18099, 2327, 10173, 12491, 6839, 902, -8870, -7050, -12957, -593, -248, -1639, -2272, -1845, 4616, -11297, -10490, 2543, 5048, 1951, 8827, -8442, 4236, -6405, -15450, -5327, -5111, -10256, -14405, -9059, -8545, -10495, -2471, 1345, -2729, -8436, -3656, 5058, 5753, 12657, 9710, 2542, 10129, 1732, 5223, 5521, 8638, -1084, 11428, 8253, 13091, 11514, 4023, 1504, -11610, -15332, -9215, -14887, -19348, -9928, -18426, -20453, -10956, -16959, -8210, -20078, -18500, -13288, -20155, -14954, -13113, -7646, -9537, -11191, 5257, -577, 10855, 14575, 11664, 5463, 10108, 819, 1111, 3710, 599, 13125, -1122, 12663, 16491, 15155, 7463, 14813, 1156, 2441, 2229, 2993, 14846, 11489, 5224, 12262, 2080, -1650, 4477, 14092, 19084, 22118, 19904, 26983, 23461, 21414, 21608, 9262, 18105, 7489, 7998, 13815, 16998, 11175, 8470, 11192, -649, 6718, 8547, 11699, 17946, 18721, 14370, 395, 7943, 14966, 10565, 13000, 8029, 15419, 7524, 12660, 4872, 2523, 11802, 4534, 17035, 4113, 11594, 12111, 16818, 11277, 12334, 839, -793, -110, -11108, -14704, -15083, -11579, 5312, 3767, 8510, 3999, 1331, -3950, -3003, -3946, -3198, 1955, -4480, 3842, 7543, -5880, 1062, -238, 11913, 5774, 5400, 12821, 15431, 8570, 369, -8366, -13405, -4972, -6760, -9383, 5864, 2908, -10135, -11785, -9132, -10484, -7576, -1233, 13426, 11706, 13195, 14348, 4857, 13388, 6645, 4551, -732, 4004, 3502, -8827, -11181, -1808, -7174, 6847, -1700, -6758, 1949, -10827, 2367, -14300, -8094, -7002, -2981, 3551, 8782, 6576, 1262, -8358, -7594, -9267, -1262, -16738, -18078, -14140, -19333, -23348, -21936, -3767, -14975, -1528, -7843, 4513, 623, -5645, -13798, -5397, -13081, -13527, 1707, -1207, 4916, 3264, -2284, 2342, 4948, 8549, 7745, 19044, 13344, 13357, 20234, 18569, 10903, 9385, 10667, -10827, -5389, -18452, -20851, -17022, -17078, -15802, -11498, 4860, 4928, 7298, 2167, -1718, -492, 1410, -4199, -11646, 12, -12229, -3710, -5043, 10290, -2519, 9031, 17543, 17696, 17461, 14445, 4495, -8639, -9281, -5184, -15985, -15597, -14850, -7681, -11524, 1210, 3643, -7411, 5587, -7536, 2556, 8612, 2008, 6187, -9089, -7386, -14635, -17231, -3829, -10217, -9054, 733, -16173, -14723, -17808, -6688, -12672, -4064, 5886, 3519, 8733, 14883, 11379, 7070, 279, 2194, -56, 8366, 3006, -8902, -4568, -2272, -5935, -2580, -3612, 8850, 7990, -334, 11811, 17524, 9383, 18899, 17597, 23990, 16691, 16180, 21178, 13699, 17459, 23608, 13439, 21273, 15080, 21611, 5805, 20726, 14816, 13503, 18168, 15470, 2428, -6339, -1913, -10237, -531, 5161, 8560, 5006, 11172, 6625, 232, 3306, -7376, 3075, -11580, -9364, -9997, -17857, -21064, -13563, -19605, -11525, -9246, -1574, 1852, -8261, -2350, 7156, 9348, 4295, 12839, 12778, 5478, 5353, 14358, 7551, 12088, 14777, 16117, 17129, 21481, 9637, 19369, 22193, 21893, 29912, 32374, 29743, 27650, 28788, 21020, 19108, 21255, 20809, 22767, 24874, 18858, 20857, 17850, 20392, 11187, 14795, -300, -10097, -6035, -17563, -16145, -3559, -16640, -6800, -5821, -7126, -14412, -12410, -10824, -9079, 1562, 2396, 3426, 5123, 10538, 6427, -2047, 5807, 10296, -2222, 8954, -6649, 4329, -6927, -8884, 911, 9583, 10504, 17646, 12801, 14153, 7821, 1517, -490, 15471, 12471, 5640, 15623, 10442, 8387, -2540, 9378, 6639, 7761, -1953, 1396, 7730, -3853, 1479, 7865, 6291, -1232, -11670, -8967, -5425, -7440, 2535, 8970, 3623, 4646, -9759, -9043, -14528, -3995, 2916, -7354, -2898, -12956, -16699, -14179, -4326, -7445, -10952, 510, 1299, 7386, 10788, 10215, 9406, 6303, -53, -1456, 10063, 11456};




/* Exported macro ------------------------------------------------------------*/
/* Exported functions ------------------------------------------------------- */
void AudioProcessWithFliter(void);
void AudioProcessWithoutFliter(void);
void Toggle_Leds(int led);
void apps(void);
void updataFliterParamer(void);
void updataFliterParamerTest(int *leftBuffer, int *rightBuffer);
void getDefaultFilterParamer(void);
void SystemAndHardwareInit(void);
void FliterInit(void);
void SetCodecVolume(uint32_t leftVol, uint32_t rightVol);//leftVol, rightVol
void getVolumeDifference(void);
void caculatePreScale(void);
void scan_Key(void);
	
//void MM3_5(void);

#endif /* __MAIN_H */

/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/
